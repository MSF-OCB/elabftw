{% extends 'base.html' %}

{% block body %}
<!-- USER INFOS -->
<section class='box'>
    <img src='app/img/user.png' alt='user' /> <h4 style='display:inline'>{% trans %}Infos{% endtrans %}</h4>
    <hr>
    <div>
        <table id='teamtable' class='table'>
            <tr>
                <th>{{ 'Name'|trans }}</th>
                <th>{{ 'Email'|trans }}</th>
                <th>{{ 'Phone'|trans }}</th>
                <th>{{ 'Mobile'|trans }}</th>
                <th>{{ 'Website'|trans }}</th>
                <th>{{ 'Skype'|trans }}</th>
            </tr>
            <tr>
                <td><a href='profile.php?id={{ ProfileUsers.userData.userid }}'>{{ ProfileUsers.userData.fullname|raw }}</span></a></td>
                <td><a href='mailto:{{ ProfileUsers.userData.email }}'>{{ ProfileUsers.userData.email }}</a></td>
                <td>{{ ProfileUsers.userData.phone }}</td>
                <td>{{ ProfileUsers.userData.cellphone }}</td>
                <td><a href='{{ ProfileUsers.userData.website }}'>{{ ProfileUsers.userData.website }}</a></td>
                <td>{{ ProfileUsers.userData.skype }}</td>
            </tr>
        </table>
        {% if TeamGroups.getTeamGroupsList|length %}
            <p>
                {% trans %}Is participating to:{% endtrans %}
                {% for value in TeamGroups.getTeamGroupsList %}
                    {{ value|trans }}{% if loop.last %}.{% else %},{% endif %}
                {% endfor %}
            </p>
        {% endif %}
        {% if App.Session.get('is_visitor') != 1 %}
            <!--@TODO : set an option in admin panel to display or not API Key-->
            {% if false %}
                <div id='api_div'><h4>{% trans %}API key{% endtrans %}</h4>
                    {% if ProfileUsers.userData.api_key|length > 0 %}
                        <input value='{{ ProfileUsers.userData.api_key }}'></input>
                    {% endif %}
                    <button class='button generateApiKey'>{% trans %}Generate an API Key{% endtrans %}</button></p>
                </div>
            {% endif %}
        {% endif %}
    </div>
</section>

<!-- EXPERIMENTS -->
{% if experimentsCount %}
    <section class='box'>
        <h4>{% trans %}Experiment{% plural 2 %}Experiments{% endtrans %}</h4>
        <hr>
        <p class='smallgray' style='display:inline'>
            {{ experimentsCount }} {% trans %}result found{% plural experimentsCount %}results found{% endtrans %}
        </p>
        <table id='teamtable' class='table'>
            <tr>
                <th>{{ 'Title'|trans }}</th>
                <th>{{ 'Author'|trans }}</th>
                <th>{{ 'Date'|trans }}</th>
                <th>{{ 'Group'|trans }}</th>
            </tr>
            {% for item in experimentsArr %}
                {% set permissions = Entity.getPermissions(item) %}
                {% if permissions.read %}
                    <tr>
                        <td><a href='experiments.php?mode=view&id={{ item.id }}'>{{ item.title|raw }}</a></td>
                        <td><a href='profile.php?id={{ item.userid }}'>{{ item.fullname }}</a></td>
                        <td>{{ item.date|kdate }}</td>
                        <td>{{ item.team_group_name }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
    </section>
{% endif %}

<!-- STATUS STAT -->
{% if experimentsCount %}
    <section class='box'>
        <img src='app/img/statistics.png' alt='' /> <h4 style='display:inline'>{% trans %}Statistics{% endtrans %}</h4>
        <hr>
        <script src='https://www.google.com/jsapi'></script>
        <script>
          google.load('visualization', '1', {packages:['corechart']});
          google.setOnLoadCallback(drawChart);
          function drawChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'status');
            data.addColumn('number', 'Experiments number');
            data.addRows([
                {% for name, percent in UserStats.percentArr %}
                    ['{{name|raw}}', {{percent}}]{% if not loop.last %},{% endif %}
                {% endfor %}
            ]);
            var options = {
                title: '{% trans %}Experiment{% plural 2 %}Experiments{% endtrans %}',
                backgroundColor: '#fff',
                colors: [
                    {% for color in UserStats.colorsArr %}
                        '#{{color}}'{% if not loop.last %},{% endif %}
                    {% endfor %}
                ]
            };
            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            chart.draw(data, options);
          }
        </script>
        <div id='chart_div' class='center'></div>
    </section>
{% endif %}

<!-- TAG CLOUD -->
{% set cloudArr = TagCloud.getCloudArr %}
{% if cloudArr|length %}
    <section class='box'>
        <img src='app/img/cloud.png' alt='' /> <h4 style='display:inline'>{% trans %}Tag cloud{% endtrans %}</h4>
        <hr>
        <div>
            {# handle minimum tag count #}
            {% if cloudArr|length <= 10 %}
                {% trans %}Not enough tags to make a tagcloud{% endtrans %}
            {% else %}
                {% for tag, class in cloudArr %}
                    <a href='experiments.php?mode=show&tag={{ tag|raw }}' class='{{ class }}'>{{ tag|raw }}</a>
                {% endfor %}
            {% endif %}
        </div>
    </section>
{% endif %}

<script src='app/js/profile.js'></script>
{% endblock body %}
