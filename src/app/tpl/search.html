{% include('head.html') %}
{% include('todolist.html') %}

<!-- SEARCH PAGE BEGIN -->
<section class='searchform box'>
    <form name="search" method="get" action="search.php">
        <div class='row'>
            <!-- SEARCH IN-->
            <div class='col-md-3'>
                <label for='searchin'>{{ 'Search in'|trans }}</label><br>
                <select name='type' id='searchin' style='width:80%;'>
                    <option value='experiments'>{% trans %}Experiment {% plural 2 %}Experiments{% endtrans %}</option>
                    <option disabled>----------------</option>
                    <option value='database' {{ Request.query.get('type') == 'database' ? 'selected' }}>{{ 'Database'|trans }}</option>
                    {% for category in categoryArr %}
                    <option value='{{ category.category_id }}' {{ Request.query.get('type') == category.category_id ? 'selected' }}>
                        {{ category.category }}
                    </option>
                    {% endfor %}
                </select>
                <!-- END SEARCH IN -->
                <br>
                <!-- SEARCH ONLY -->
                    <label for'searchonly'>{{ 'Search only in experiments owned by:'|trans }} </label><br>
                    <!-- when you change this select, you reload the page so the tag selector loads the correct tags -->
                    <select id='searchonly' name='owner' style='width:80%;'>
                        <!-- add an option to search in the whole team (owner = 0) -->
                        <option value='0' {{ Request.query.get('owner') == '0' ? 'selected' }}>{{ 'All the team'|trans }}</option>
                        <option value=''>{{ 'Yourself'|trans }}</option>
                        <option disabled>----------------</option>
                        {% for user in usersArr %}
                            <option value='{{ user.userid }}' {{ Request.query.get('owner') == user.userid ? 'selected' }}>
                                {{ user.fullname|raw }}
                            </option>
                        {% endfor %}
                    </select>
                <!-- END SEARCH ONLY -->
            </div>

            <!-- SEARCH WITH TAG -->
            {% set tagExpOptions = Experiments.Tags.generateTagList(tagsArr) %}
            {% set tagDbOptions = Database.Tags.generateTagList(tagsArr) %}

            <div class='col-md-3' id='tag_exp'>
                <label for='tag_exp'>{{ 'With the tag'|trans }}</label>
                <select multiple name='tag_exp[]' style='width:100%; padding-right:30px; height:103px;'>
                    {{ tagExpOptions|raw }}
                </select>
            </div>

            <div class='col-md-3' id='tag_db'>
                <label for='tag_db'>{{ 'With the tag'|trans }}</label>
                <select multiple name='tag_db[]'>
                    {{ tagDbOptions|raw }}
                </select>
            </div>
            <!-- END SEARCH WITH TAG -->

            <!-- VISIBILITY SEARCH -->
            <div class='col-md-6'>
                <label for'visibility'>{{ 'And visibility is:'|trans }} </label><br>
                <select id='visibility' name='vis' style='width:60%;'>
                    <option value=''>{{ 'Select visibility'|trans }}</option>
                    <option value='organization' {{ Request.query.get('vis') == 'organization' ? 'selected' }}>{{ 'Organization'|trans }}</option>
                    <option value='team' {{ Request.query.get('vis') == 'team' ? 'selected' }}>{{ 'Team'|trans }}</option>
                    <option value='user' {{ Request.query.get('vis') == 'user' ? 'selected' }}>{{ 'Only me'|trans }}</option>
                    {% for teamGroup in teamGroupsArr %}
                        <option value='{{ teamGroup.id }}' {{ Request.query.get('vis') == teamGroup.id ? 'selected' }}>
                        {{ 'Group'|trans }} {{ teamGroup.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <br>
            <!-- END VISIBILITY SEARCH -->
            <!-- STATUS -->
            <div class='col-md-4'>
                <label for='status'>{{ 'And status is'|trans }}</label><br>
                <select id='status' name='status' style='width:60%;'>
                    <option value=''>{{ 'select status'|trans }}</option>
                    {% for status in statusArr %}
                        <option value='{{ status.category_id }}' {{ Request.query.get('status') == status.category_id ? 'selected' }}>
                            {{ status.category }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <!-- END STATUS -->
        </div>
<br>
        <!-- NEW ROW -->
        <div class='row'>

            <!-- TITLE -->
            <div class='col-md-6'>
                <label for='title'>{{ 'And title contains'|trans }}</label>
                <input id='title' name='title' type='text' value='{{ title }}'/>
            </div>
            <!-- END TITLE -->
            <!-- RATING -->
            <div class='col-md-4'>
                <label for='rating'>{{ 'And rating is'|trans }}</label><br>
                <select id='rating' name='rating' style='width:60%;'>
                    <option value=''>{{ 'select number of stars'|trans }}</option>
                    <option value='no'>{{ 'Unrated'|trans }}</option>
                    {% for i in range(1, 5) %}
                        <option value='{{ i }}' {{ Request.query.get('rating') == i ? 'selected' }}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <!-- END RATING -->
        </div>

        <!-- NEW ROW -->
        <div class='row'>

            <!-- BODY -->
            <div class='col-md-6'>
                <label for='body'>{{ 'And body contains'|trans }}</label>
                <input id='body' name='body' type='text' value='{{ body }}'/>
                <br>
                <p style='font-size:90%;' align='right'><i>{{ "Tip: you can use '%' as wildcard."|trans }}</i></p>
            </div>

            <!-- END TITLE/BODY block -->
            <!-- AND / OR -->
            <div class='col-md-4'>
              <label for='andor'>&nbsp;</label><br>
              <select id='andor' name='andor'>
                <option value='' disabled selected>{{ 'Space means'|trans }}</option>
                <option value='and' {{ Request.query.get('andor') == 'and' ? 'selected' }}>{{ 'and'|trans }}</option>
                <option value='or' {{ Request.query.get('andor') == 'or' ? 'selected' }}>{{ 'or'|trans }}</option>
            </select>
          </div>
        </div>
        <!-- NEW ROW -->
        <div class='row'>

            <!-- SEARCH DATE -->
            <div class='col-md-8'>
                <label for='from'>{{ 'Where date is between'|trans }}</label>
                <input id='from' name='from' type='text' size='8' class='datepicker' value='{{ Request.query.get('from') != '' ? Request.query.get('from') }}'/>
                <label span style='margin:0 10px;' for='to'> {{ 'and'|trans }} </label>
                <input id='to' name='to' type='text' size='8' class='datepicker' value='{{ Request.query.get('to') != '' ? Request.query.get('to') }}'/>
            </div>
            <!-- END SEARCH DATE -->

        </div>

        <div style='margin:30px;' class='center'>
            <button id='searchButton' class='button' value='Submit' type='submit'>
                {{ 'Launch search'|trans }}
            </button>
        </div>
    </form>
</section>
<a href='#' id='anchor'></a>
<script src='app/js/search.min.js'></script>
